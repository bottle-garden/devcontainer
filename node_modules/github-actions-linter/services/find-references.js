"use strict";
/*!
 * Copyright 2019 Omar Tawfik. Please see LICENSE file at the root of this repository.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var vscode_languageserver_1 = require("vscode-languageserver");
var cache_1 = require("../util/cache");
var FindReferencesService = /** @class */ (function () {
    function FindReferencesService() {
    }
    FindReferencesService.prototype.fillCapabilities = function (capabilities) {
        capabilities.referencesProvider = true;
    };
    FindReferencesService.prototype.activate = function (connection, documents) {
        connection.onReferences(function (params) {
            var uri = params.textDocument.uri;
            var compilation = cache_1.accessCache(documents, uri);
            var target = compilation.getTargetAt(params.position);
            if (!target) {
                return undefined;
            }
            var action = compilation.actions.get(target.name);
            if (!action) {
                return undefined;
            }
            return action.references.map(function (range) { return vscode_languageserver_1.Location.create(uri, range); });
        });
    };
    return FindReferencesService;
}());
exports.FindReferencesService = FindReferencesService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9zZXJ2aWNlcy9maW5kLXJlZmVyZW5jZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILCtEQUFpRztBQUVqRyx1Q0FBNEM7QUFFNUM7SUFBQTtJQXVCQSxDQUFDO0lBdEJRLGdEQUFnQixHQUF2QixVQUF3QixZQUFnQztRQUN0RCxZQUFZLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO0lBQ3pDLENBQUM7SUFFTSx3Q0FBUSxHQUFmLFVBQWdCLFVBQXVCLEVBQUUsU0FBd0I7UUFDL0QsVUFBVSxDQUFDLFlBQVksQ0FBQyxVQUFBLE1BQU07WUFDcEIsSUFBQSw2QkFBRyxDQUF5QjtZQUNwQyxJQUFNLFdBQVcsR0FBRyxtQkFBVyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUVoRCxJQUFNLE1BQU0sR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsTUFBTSxFQUFFO2dCQUNYLE9BQU8sU0FBUyxDQUFDO2FBQ2xCO1lBRUQsSUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ1gsT0FBTyxTQUFTLENBQUM7YUFDbEI7WUFFRCxPQUFPLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsZ0NBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUEzQixDQUEyQixDQUFDLENBQUM7UUFDckUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0gsNEJBQUM7QUFBRCxDQXZCQSxBQXVCQyxJQUFBO0FBdkJZLHNEQUFxQiIsImZpbGUiOiJzcmMvc2VydmljZXMvZmluZC1yZWZlcmVuY2VzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBDb3B5cmlnaHQgMjAxOSBPbWFyIFRhd2Zpay4gUGxlYXNlIHNlZSBMSUNFTlNFIGZpbGUgYXQgdGhlIHJvb3Qgb2YgdGhpcyByZXBvc2l0b3J5LlxuICovXG5cbmltcG9ydCB7IElDb25uZWN0aW9uLCBUZXh0RG9jdW1lbnRzLCBTZXJ2ZXJDYXBhYmlsaXRpZXMsIExvY2F0aW9uIH0gZnJvbSBcInZzY29kZS1sYW5ndWFnZXNlcnZlclwiO1xuaW1wb3J0IHsgTGFuZ3VhZ2VTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZlclwiO1xuaW1wb3J0IHsgYWNjZXNzQ2FjaGUgfSBmcm9tIFwiLi4vdXRpbC9jYWNoZVwiO1xuXG5leHBvcnQgY2xhc3MgRmluZFJlZmVyZW5jZXNTZXJ2aWNlIGltcGxlbWVudHMgTGFuZ3VhZ2VTZXJ2aWNlIHtcbiAgcHVibGljIGZpbGxDYXBhYmlsaXRpZXMoY2FwYWJpbGl0aWVzOiBTZXJ2ZXJDYXBhYmlsaXRpZXMpOiB2b2lkIHtcbiAgICBjYXBhYmlsaXRpZXMucmVmZXJlbmNlc1Byb3ZpZGVyID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyBhY3RpdmF0ZShjb25uZWN0aW9uOiBJQ29ubmVjdGlvbiwgZG9jdW1lbnRzOiBUZXh0RG9jdW1lbnRzKTogdm9pZCB7XG4gICAgY29ubmVjdGlvbi5vblJlZmVyZW5jZXMocGFyYW1zID0+IHtcbiAgICAgIGNvbnN0IHsgdXJpIH0gPSBwYXJhbXMudGV4dERvY3VtZW50O1xuICAgICAgY29uc3QgY29tcGlsYXRpb24gPSBhY2Nlc3NDYWNoZShkb2N1bWVudHMsIHVyaSk7XG5cbiAgICAgIGNvbnN0IHRhcmdldCA9IGNvbXBpbGF0aW9uLmdldFRhcmdldEF0KHBhcmFtcy5wb3NpdGlvbik7XG4gICAgICBpZiAoIXRhcmdldCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhY3Rpb24gPSBjb21waWxhdGlvbi5hY3Rpb25zLmdldCh0YXJnZXQubmFtZSk7XG4gICAgICBpZiAoIWFjdGlvbikge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWN0aW9uLnJlZmVyZW5jZXMubWFwKHJhbmdlID0+IExvY2F0aW9uLmNyZWF0ZSh1cmksIHJhbmdlKSk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==
