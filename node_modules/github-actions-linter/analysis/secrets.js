"use strict";
/*!
 * Copyright 2019 Omar Tawfik. Please see LICENSE file at the root of this repository.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../util/constants");
function analyzeSecrets(document, bag) {
    var allSecrets = new Set();
    document.actions.forEach(function (action) {
        if (!action.secrets) {
            return;
        }
        var localSecrets = new Set();
        action.secrets.secrets.forEach(function (secret) {
            if (localSecrets.has(secret.value)) {
                bag.duplicateSecrets(secret.value, secret.syntax.range);
            }
            else {
                localSecrets.add(secret.value);
            }
            if (!allSecrets.has(secret.value)) {
                if (allSecrets.size === constants_1.MAXIMUM_SUPPORTED_SECRETS) {
                    bag.tooManySecrets(secret.syntax.range);
                }
                allSecrets.add(secret.value);
            }
        });
    });
}
exports.analyzeSecrets = analyzeSecrets;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hbmFseXNpcy9zZWNyZXRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCwrQ0FBOEQ7QUFFOUQsU0FBZ0IsY0FBYyxDQUFDLFFBQXVCLEVBQUUsR0FBa0I7SUFDeEUsSUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztJQUVyQyxRQUFRLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFBLE1BQU07UUFDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7WUFDbkIsT0FBTztTQUNSO1FBRUQsSUFBTSxZQUFZLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztRQUN2QyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxNQUFNO1lBQ25DLElBQUksWUFBWSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ2xDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDekQ7aUJBQU07Z0JBQ0wsWUFBWSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDaEM7WUFFRCxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ2pDLElBQUksVUFBVSxDQUFDLElBQUksS0FBSyxxQ0FBeUIsRUFBRTtvQkFDakQsR0FBRyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUN6QztnQkFDRCxVQUFVLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUM5QjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBeEJELHdDQXdCQyIsImZpbGUiOiJzcmMvYW5hbHlzaXMvc2VjcmV0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQ29weXJpZ2h0IDIwMTkgT21hciBUYXdmaWsuIFBsZWFzZSBzZWUgTElDRU5TRSBmaWxlIGF0IHRoZSByb290IG9mIHRoaXMgcmVwb3NpdG9yeS5cbiAqL1xuXG5pbXBvcnQgeyBCb3VuZERvY3VtZW50IH0gZnJvbSBcIi4uL2JpbmRpbmcvYm91bmQtbm9kZXNcIjtcbmltcG9ydCB7IERpYWdub3N0aWNCYWcgfSBmcm9tIFwiLi4vdXRpbC9kaWFnbm9zdGljc1wiO1xuaW1wb3J0IHsgTUFYSU1VTV9TVVBQT1JURURfU0VDUkVUUyB9IGZyb20gXCIuLi91dGlsL2NvbnN0YW50c1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gYW5hbHl6ZVNlY3JldHMoZG9jdW1lbnQ6IEJvdW5kRG9jdW1lbnQsIGJhZzogRGlhZ25vc3RpY0JhZyk6IHZvaWQge1xuICBjb25zdCBhbGxTZWNyZXRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgZG9jdW1lbnQuYWN0aW9ucy5mb3JFYWNoKGFjdGlvbiA9PiB7XG4gICAgaWYgKCFhY3Rpb24uc2VjcmV0cykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGxvY2FsU2VjcmV0cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIGFjdGlvbi5zZWNyZXRzLnNlY3JldHMuZm9yRWFjaChzZWNyZXQgPT4ge1xuICAgICAgaWYgKGxvY2FsU2VjcmV0cy5oYXMoc2VjcmV0LnZhbHVlKSkge1xuICAgICAgICBiYWcuZHVwbGljYXRlU2VjcmV0cyhzZWNyZXQudmFsdWUsIHNlY3JldC5zeW50YXgucmFuZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxTZWNyZXRzLmFkZChzZWNyZXQudmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWFsbFNlY3JldHMuaGFzKHNlY3JldC52YWx1ZSkpIHtcbiAgICAgICAgaWYgKGFsbFNlY3JldHMuc2l6ZSA9PT0gTUFYSU1VTV9TVVBQT1JURURfU0VDUkVUUykge1xuICAgICAgICAgIGJhZy50b29NYW55U2VjcmV0cyhzZWNyZXQuc3ludGF4LnJhbmdlKTtcbiAgICAgICAgfVxuICAgICAgICBhbGxTZWNyZXRzLmFkZChzZWNyZXQudmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn1cbiJdfQ==
