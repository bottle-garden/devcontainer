"use strict";
/*!
 * Copyright 2019 Omar Tawfik. Please see LICENSE file at the root of this repository.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var LRU = require("lru-cache");
var compilation_1 = require("./compilation");
var cache = new LRU(10);
function accessCache(documents, uri, version) {
    var entry = cache.get(uri);
    if (entry && entry.version === version) {
        return entry.compilation;
    }
    var document = documents.get(uri);
    if (!document) {
        throw new Error("Cannot find a document with uri: " + uri);
    }
    else if (entry && entry.version === document.version) {
        return entry.compilation;
    }
    var compilation = new compilation_1.Compilation(document.getText());
    cache.set(uri, {
        compilation: compilation,
        version: document.version,
    });
    return compilation;
}
exports.accessCache = accessCache;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy91dGlsL2NhY2hlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCwrQkFBaUM7QUFDakMsNkNBQTRDO0FBUTVDLElBQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFnQixFQUFFLENBQUMsQ0FBQztBQUV6QyxTQUFnQixXQUFXLENBQUMsU0FBd0IsRUFBRSxHQUFXLEVBQUUsT0FBZ0I7SUFDakYsSUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLE9BQU8sRUFBRTtRQUN0QyxPQUFPLEtBQUssQ0FBQyxXQUFXLENBQUM7S0FDMUI7SUFFRCxJQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDYixNQUFNLElBQUksS0FBSyxDQUFDLHNDQUFvQyxHQUFLLENBQUMsQ0FBQztLQUM1RDtTQUFNLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssUUFBUSxDQUFDLE9BQU8sRUFBRTtRQUN0RCxPQUFPLEtBQUssQ0FBQyxXQUFXLENBQUM7S0FDMUI7SUFFRCxJQUFNLFdBQVcsR0FBRyxJQUFJLHlCQUFXLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDeEQsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUU7UUFDYixXQUFXLGFBQUE7UUFDWCxPQUFPLEVBQUUsUUFBUSxDQUFDLE9BQU87S0FDMUIsQ0FBQyxDQUFDO0lBRUgsT0FBTyxXQUFXLENBQUM7QUFDckIsQ0FBQztBQXBCRCxrQ0FvQkMiLCJmaWxlIjoic3JjL3V0aWwvY2FjaGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIENvcHlyaWdodCAyMDE5IE9tYXIgVGF3ZmlrLiBQbGVhc2Ugc2VlIExJQ0VOU0UgZmlsZSBhdCB0aGUgcm9vdCBvZiB0aGlzIHJlcG9zaXRvcnkuXG4gKi9cblxuaW1wb3J0ICogYXMgTFJVIGZyb20gXCJscnUtY2FjaGVcIjtcbmltcG9ydCB7IENvbXBpbGF0aW9uIH0gZnJvbSBcIi4vY29tcGlsYXRpb25cIjtcbmltcG9ydCB7IFRleHREb2N1bWVudHMgfSBmcm9tIFwidnNjb2RlLWxhbmd1YWdlc2VydmVyXCI7XG5cbmludGVyZmFjZSBFbnRyeSB7XG4gIHJlYWRvbmx5IHZlcnNpb246IG51bWJlcjtcbiAgcmVhZG9ubHkgY29tcGlsYXRpb246IENvbXBpbGF0aW9uO1xufVxuXG5jb25zdCBjYWNoZSA9IG5ldyBMUlU8c3RyaW5nLCBFbnRyeT4oMTApO1xuXG5leHBvcnQgZnVuY3Rpb24gYWNjZXNzQ2FjaGUoZG9jdW1lbnRzOiBUZXh0RG9jdW1lbnRzLCB1cmk6IHN0cmluZywgdmVyc2lvbj86IG51bWJlcik6IENvbXBpbGF0aW9uIHtcbiAgY29uc3QgZW50cnkgPSBjYWNoZS5nZXQodXJpKTtcbiAgaWYgKGVudHJ5ICYmIGVudHJ5LnZlcnNpb24gPT09IHZlcnNpb24pIHtcbiAgICByZXR1cm4gZW50cnkuY29tcGlsYXRpb247XG4gIH1cblxuICBjb25zdCBkb2N1bWVudCA9IGRvY3VtZW50cy5nZXQodXJpKTtcbiAgaWYgKCFkb2N1bWVudCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGZpbmQgYSBkb2N1bWVudCB3aXRoIHVyaTogJHt1cml9YCk7XG4gIH0gZWxzZSBpZiAoZW50cnkgJiYgZW50cnkudmVyc2lvbiA9PT0gZG9jdW1lbnQudmVyc2lvbikge1xuICAgIHJldHVybiBlbnRyeS5jb21waWxhdGlvbjtcbiAgfVxuXG4gIGNvbnN0IGNvbXBpbGF0aW9uID0gbmV3IENvbXBpbGF0aW9uKGRvY3VtZW50LmdldFRleHQoKSk7XG4gIGNhY2hlLnNldCh1cmksIHtcbiAgICBjb21waWxhdGlvbixcbiAgICB2ZXJzaW9uOiBkb2N1bWVudC52ZXJzaW9uLFxuICB9KTtcblxuICByZXR1cm4gY29tcGlsYXRpb247XG59XG4iXX0=
